
## *On The Line* Style Guide with Bookdown-flavored Markdown {-}

Code comments
```
<!-- this comment appears in the source code, but not the book outputs -->
```

Use brackets and parentheses for an [embedded link](http://example.com)

Use parentheses only for a non-embedded link (http://example.com)

Similarly, display URL with angle brackets: <http://example.com>

If necessary, use HTML to create <a href="http://example.com/">link that opens in a new page</a>

##### Headers and Cross-reference links {-}

Use one hashtag for a chapter title (first-level header)
```
# Chapter title
```
Use two hashtags for a section title (second-level header)
```
## Section title
```
A short chapter title `# Introduction` has a short default reference: `#introduction`, while a longer chapter title `# Defining City and Suburban Lines` has a longer default reference: `#defining-city-and-suburban-lines`

To simplify long chapter title references, insert a short ID name in curly brackets: `# Defining City and Suburban Lines {#defining}`

To embed a cross-reference to a chapter title, add a link using brackets and parentheses:

- short reference code: `*by [Jack Dougherty](index.html#authors-and-contributors)*` with demo: *by [Jack Dougherty](index.html#authors-and-contributors)*
- short ID reference code: `see chapter [Defining City and Suburban Lines](#defining)` with demo: see chapter [Defining City and Suburban Lines](#defining)

To embed a cross-reference link to a section title (inside a chapter), add a link (to the docs HTML page and section hashtag) using brackets and parentheses:

- Contributor code: `Shaun McGann (Trinity 2014) co-authored [Federal Lending and Redlining](separating.html#federal-lending-and-redlining)`
- Contributor demo: Shaun McGann (Trinity 2014) co-authored [Federal Lending and Redlining](separating.html#federal-lending-and-redlining).
- Learn More code: `in this book about [How We Found Restrictive Covenants](creating.html#how-we-found-restrictive-covenants)`
- Learn More demo: in this book about [How We Found Restrictive Covenants](creating.html#how-we-found-restrictive-covenants)

NOTE that the cross-reference codes above are designed primarily for web books, and may or may not work the same way in ebooks.

Hide numbers from appearing in section headers with curly brackets around hyphen:
- code: `## Outline of the Book {-}`

However, since I have not yet found a way to insert a short section reference AND hide its number, we must use full section references with hidden numbers.

For an em-dash, use three hyphens---like this---rather than two hyphens.

For a block quote, start each line with a caret **AND** add two spaces to insert a line break:

> I thoroughly disapprove of duels. If a man should challenge me, I would take him kindly and forgivingly by the hand and lead him to a quiet place and kill him.    
> --- Mark Twain  
> --- notable American author  


#### Zotero Settings and Footnotes {-}

This workflow uses open-source Zotero bibliography manager (http://zotero.org) with Better BibTeX extension (https://retorque.re/zotero-better-bibtex/). See [Better BibTeX installation](https://retorque.re/zotero-better-bibtex/installation/). This allows the author to insert footnote codes (example: `@tyackOneBestSystem1974`) and configure bookdown settings (such as Chicago note format) that pull footnotes from a recently downloaded Zotero collection, rather than typing each note directly into the book.

Zotero preferences > Better BibTeX

- add URLs to BibTeX export > in a note field
- when ref has both DOI and URL, export > both

To export from Zotero:

- select library > right-click to export collection
- select format > Better BibLaTeX (*IMPORTANT* I switched to this format to include full dates in newspaper citations, and urls) and leave checkboxes blank (I do not use "keep updated")
- save output as ontheline.bib (or whatever matches your config settings) and save into book repo

Chicago full-note *appears* to be working exactly as it was designed, meaning that the second instance of a citation currently appears as an abbreviated note (Author, title when appropriate). Ideally, modify the CSL to show full note in *every* instance in the web version.

These Zotero types appear correctly with this Bookdown workflow:

- book
- book chapter
- journal
- newspaper
- thesis
- report
- blog post
- web page
- document (use this in place of: law case, presentation, interview, video recording, television broadcast; insert details, such as archival location, in the Publisher field)


A text-only footnote.^[This is a footnote, with no reference]

BibText footnote with semi-colons to separate cites: [@hirschMakingSecondGhetto1983; @jacksonCrabgrassFrontierSuburbanization1985; @tyackOneBestSystem1974]

Markdown caret-footnote, which can accept multiple references with complex punctuation.^[On this theme, see @doughertyReviewConnecticutPublic2011. On a different theme, see @doughertySchoolChoiceSuburbia2009, pp. 33-35]

#### Subheadings need four hashtags and no-number symbol {-}
Note: Using three hashtags makes the subheader appear in the TOC because I have not found way to control toc_depth in web output. Use the no-number symbol to prevent automatic number of subheaders.

#### Figures: Static Images and Interactive Content {-}
In body of the book, avoid inserting images with simple Markdown syntax, because it lacks auto-numbering. (In the preface, use simple Markdown syntax for static images, because Bookdown does not auto-number figures in the index.Rmd file.)

Instead, follow this R code chunk method, especially to display interactive content on the HTML web edition, with static screenshot images in the PDF edition:

- Define a text reference for captions with complex formatting, because this method accepts RMarkdown cites and links. See [Bookdown section 2.2.4](https://bookdown.org/yihui/bookdown/markdown-extensions-by-bookdown.html)
- Leave a BLANK LINE between the text reference and the code chunk coming up
- Insert an R code chunk <https://bookdown.org/yihui/bookdown/r-code.html>, with NO SPACES between ref:chunk-label, and follow with an if-else statement from Michael Dorman, to display interactive version in HTML and static version in PDF.
- STILL TO DO:
  - Find code fix to gain control over HTML iframe height (> 400px) and also width (ideally 90%)
  - Find code fix to insert a formatted title or header immediately above the image. Ideally, Use equivalent of 5 hashtags for digital image headers, and imperative verbs to hint interactive use (eg. Explore the Map....)
  - Decide whether to insert `fig.align="center"`
  - Decide if `auto.PDF=TRUE` is necessary

REMINDER: If the image/map/video appears a second time in the book (in a separate chapter), be sure to relabel ref: year-title2

##### Example: Static image, with no interactive version {-}
(ref:sample-static-image) Caption for sample static image, with Markdown formatting, links, citation.

```{r sample-static-image, echo=FALSE, fig.cap="(ref:sample-static-image)", fig_height=7}
 knitr::include_graphics("images/1937-holc-hartford-map-scan.jpg")
```

##### Example: Interactive map {-}
(ref:sample-interactive-map) Scroll down the narrative (or click and use arrow keys) in this [interactive map](https://ontheline.github.io/otl-town-borders/) to see how Hartford County, Connecticut was divided into 29 separate towns from the early 1600s to the late 1800s. Boundaries shown here are not exact, but approximated from the best available digital sources: UConn Libraries MAGIC historical maps, Atlas of Historical County Boundaries at Newberry Library, and the Connecticut State Register and Manual. View [map historical sources, known issues, and the code](https://github.com/ontheline/otl-town-borders/), developed by Ilya Ilyankou and Jack Dougherty.^[@ilyankouMapTownBorders2017]

```{r sample-interactive-map, echo=FALSE, fig.cap="(ref:sample-interactive-map)", fig_height=7}
if(knitr::is_html_output()) knitr::include_url("https://ontheline.github.io/otl-town-borders/") else knitr::include_graphics("images/1600s-otl-town-borders.jpg")
```

##### Example: Vimeo video clip {-}
(ref:vimeo-sample-video) Here's a sample Vimeo caption, with option to add Markdown link and footnote.

```{r vimeo-sample-vimeo, echo=FALSE, fig.cap="(ref:vimeo-sample-video)"}
if(knitr::is_html_output()) knitr::include_url("https://player.vimeo.com/video/27299734") else knitr::include_graphics("images/2011-walsh-debra.jpg")
```

##### Example: YouTube video clip {-}
(ref:youtube-sample-video) Here's a sample YouTube caption, with option to add Markdown link and footnote.

```{r youtube-sample-video, echo=FALSE, fig.cap="(ref:youtube-sample-video)"}
if(knitr::is_html_output()) knitr::include_url("https://www.youtube.com/embed/NuWg9Jrkrpw?start=64") else knitr::include_graphics("images/2013-cthistory-video-screenshot.png")
```
##### Example: CTDA video clip {-}
(ref:ctda-sample-video) Here's a sample CTDA video caption, with option to add Markdown link and footnote.

```{r ctda-sample-video, echo=FALSE, fig.cap="(ref:ctda-sample-video)"}
if(knitr::is_html_output()) knitr::include_url("https://collections.ctdigitalarchive.org/islandora/object/120002%3A221/datastream/MP4/view") else knitr::include_graphics("images/2014-lumpkin-mae-willie-screenshot.png")
```
##### Example: Kaltura video clip {-}
(ref:kaltura-sample-video) Here's a sample Kaltura video caption, with option to add Markdown link and footnote.

```{r kaltura-sample-video, echo=FALSE, fig.cap="(ref:kaltura-sample-video)"}
if(knitr::is_html_output()) knitr::include_url("https://cdnapisec.kaltura.com/html5/html5lib/v2.76/mwEmbedFrame.php/p/2366381/uiconf_id/42684261/entry_id/1_1jk9ch6s?wid=_2366381&iframeembed=true&playerId=kaltura_player&entry_id=1_1jk9ch6s") else knitr::include_graphics("images/2006-hartford-profiles-1.png")
```
##### Example: Scrollable local PDF {-}
(ref:pdf-sample-local) Here's a sample local scrollable PDF caption, with option to add Markdown link and footnote.

```{r pdf-sample-local, echo=FALSE, fig.cap="(ref:pdf-sample-local)"}
if(knitr::is_html_output()) knitr::include_url("images/sample-3pp.pdf") else knitr::include_graphics("images/sample-pdf-screenshot.png")
```

#### Tables
For now, use Markdown table formatting, with header above and text (as caption) below

#### References for above {-}

- R Markdown book section on figures https://bookdown.org/yihui/rmarkdown/html-document.html#figure-options
- R Markdown reference https://www.rstudio.com/wp-content/uploads/2015/03/rmarkdown-reference.pdf
- On R code chunks in RMarkdown https://bookdown.org/yihui/rmarkdown/r-code.html
- On R code options in knitr package https://yihui.name/knitr/options
- Tips and tricks http://zevross.com/blog/2017/06/19/tips-and-tricks-for-working-with-images-and-figures-in-r-markdown-documents/#arguments-out.width-and-out.height-apply-to-both-existing-images-and-r-generated-figures


## *On The Line* Style Guide for Bookdown + RMarkdown {-}

NOTE: View this file and the code used to create the examples directly on the GitHub repo at <https://github.com/OnTheLine/otl-bookdown/blob/master/09.4-style-guide.Rmd>.

Also, this style guide was created primarily for the web edition <http://OnTheLine.trincoll.edu>, and may require additional modifications for the final PDF print edition.

Use HTML-style code comments to insert notes that are invisible to most readers, yet visible to authors (or anyone) viewing the public GitHub repo
```
<!-- this comment appears in the source code, but not the book products -->
```

Use brackets and parentheses for an [embedded link](http://example.com)

Use parentheses only for a non-embedded link (http://example.com)

Similarly, display URL with angle brackets: <http://example.com>

If necessary, use HTML tags to create <a href="http://example.com/">link that opens in a new page</a>

##### Headers and Cross-reference links {-}

Use one hashtag for a chapter title (first-level header)

- Code: `# Chapter title`

Use two hashtags for a section title (second-level header)

- Code:  `## Section title`
-
Use four or five hashtags, followed by curly brackets, for subheaders in chapters/sections:

- Code: `#### Subheader Inside the Body Text {-}`
- code: `##### Subheader for Table  `

Hide numbers from appearing in section headers with curly brackets around hyphen:

- code: `## Outline of the Book {-}`

Note that this book uses full section references with hidden numbers, because I have not yet found a way to insert a short section reference AND hide its number.

A short chapter title `# Introduction` has a short default reference: `#introduction`, while a longer chapter title `# Defining City and Suburban Lines` has a longer default reference: `#defining-city-and-suburban-lines`

To simplify long chapter title references, insert a short ID name in curly brackets: `# Defining City and Suburban Lines {#defining}`

To embed a cross-reference to a chapter title, add a link using brackets and parentheses:

- short reference code: `*by [Jack Dougherty](index.html#authors-and-contributors)*` with demo: *by [Jack Dougherty](index.html#authors-and-contributors)*
- short ID reference code: `see chapter [Defining City and Suburban Lines](#defining)` with demo: see chapter [Defining City and Suburban Lines](#defining)

To embed a cross-reference link to a section title (inside a chapter), add a link (to the docs HTML page and section hashtag) using brackets and parentheses:

- Code for contributor: `Shaun McGann (Trinity 2014) co-authored [Federal Lending and Redlining](separating.html#federal-lending-and-redlining)`
- Demo for contributor: Shaun McGann (Trinity 2014) co-authored [Federal Lending and Redlining](separating.html#federal-lending-and-redlining).
- Code for learn more: `in this book about [How We Found Restrictive Covenants](teaching-researching.html#how-we-found-restrictive-covenants)`
- Demo for learn more: in this book about [How We Found Restrictive Covenants](teaching-researching.html#how-we-found-restrictive-covenants)

For an em-dash, use three hyphens---like this---rather than two hyphens.

For a block quote, start each line with a caret **AND** add two spaces to insert a line break:

> I thoroughly disapprove of duels. If a man should challenge me, I would take him kindly and forgivingly by the hand and lead him to a quiet place and kill him.    
> --- Mark Twain  
> --- notable American author  

A text-only footnote.^[This is a footnote, with no reference.]

To create a footnote with citations only, separate BibTeX citation keys with semi-colons: [@hirschMakingSecondGhetto1983; @jacksonCrabgrassFrontierSuburbanization1985; @tyackOneBestSystem1974]

Since footnotes also may include text and punctionation in Markdown syntax, always insert a caret symbol prior to the brackets to demarcate a footnote:^[On this theme, see @doughertyReviewConnecticutPublic2011. On a different theme, see @doughertySchoolChoiceSuburbia2009, pp. 33-35]

#### Subheadings need four hashtags and no-number symbol {-}
Note: Using three hashtags makes the subheader appear in the TOC because I have not found way to control toc_depth in the Web edition. Use the no-number symbol to prevent automatic number of subheaders.

#### Figures: Interactive Content and Static Images {-}
In body of the book, avoid inserting images with simple Markdown syntax, because it lacks auto-numbering. Instead, follow this R code chunk method, especially to display interactive content on the HTML web edition, with static screenshot images in the PDF edition:

##### Overview of steps {-}
- Define a text reference for captions, because this method accepts complex syntax, such as RMarkdown cites and links, as shown below. For details, see Bookdown sections on Figures <https://bookdown.org/yihui/bookdown/figures.html> and Markdown extensions <https://bookdown.org/yihui/bookdown/markdown-extensions-by-bookdown.html>.
- Insert a BLANK LINE between the text reference and the R code chunk coming up.
- Insert an R code chunk <https://bookdown.org/yihui/bookdown/r-code.html>, with NO SPACES between ref:chunk-label, as shown below.
- To reduce the width (or height) of the output, add `out.width="30%"` to the code chunk, which works for Web edition and also PDF edition. If width is less than full, also insert `fig.align="center"`.
- To display interactive content in the Web edition and a static image in the PDF edition, create both elements and insert an if-else statement in the R code chunk to display these elements in different outputs, as shown below. (Thanks to Michael Dorman for this tip.)
- If the interactive content includes an iframe (for a map or chart), the default height will be 400 pixels. To adjust the iframe height (or width), insert a line of code in `custom-scripts.html` and add a code comment to the text to serve as a reminder, as shown below. Also, make sure that the `index.Rmd` file includes the custom script in the header, as described in the section above.
- - Optional: In the body text, insert a dynamic reference to the figure in the same file, because PDF engine creates floating images that may be placed on the next page. Sample dynamic reference to a figure further below: ... as shown in Figure \@ref(fig:sample-interactive).

- Reminders:
  - If the image appears a second time in the book, in a separate chapter, be sure to relabel the text ref: year-title2.
  - Bookdown does not auto-number figures in the index.Rmd file, which serves as a preface or introduction.

- STILL TODO
  - Decide if 'out.width' and 'out.height' is preferable in all cases to `"fig_height=7"`
  - Accessibility: use alt="" for brief image description? Or do the detailed captions replace this need?
  - About auto_pdf: "include_graphics() can be smart enough to use PDF graphics automatically when the output format is LaTeX and the PDF graphics files exist, e.g., an image path foo/bar.png can be automatically replaced with foo/bar.pdf if the latter exists. PDF images often have better qualities than raster images in LaTeX/PDF output. To make use of this feature, set the argument auto_pdf = TRUE, or set the global option options(knitr.graphics.auto_pdf = TRUE) to enable this feature globally in an R session." from https://bookdown.org/yihui/bookdown/figures.html

##### Example: Static image in all editions, half-size output, no interactive version {-}
(ref:sample-static-image) Caption for sample static image, with Markdown formatting, links, citation.

```{r sample-static-image, echo=FALSE, fig.cap="(ref:sample-static-image)", out.width="50%"}
 knitr::include_graphics("images/1937-holc-hartford-map-scan.jpg")
```

##### Example: Interactive iframe in web edition (with adjusted height), static image in PDF edition  {-}
(ref:sample-interactive) Caption for all versions here, with link to [full-screen interactive map with its own caption](https://ontheline.github.io/otl-redlining/index-caption.html), and link to sources and the code  View [map historical sources, known issues, and the code](https://github.com/ontheline/otl-redlining/), developed by Ilya Ilyankou and Jack Dougherty, with footnote.^[@ilyankouMapRestrictiveCovenants2017]

<!-- set iframe 600px height 100% width in custom-scripts.html -->
```{r sample-interactive, echo=FALSE, fig.cap="(ref:sample-interactive)"}
if(knitr::is_html_output()) knitr::include_url("https://ontheline.github.io/otl-redlining/") else knitr::include_graphics("images/1937-otl-redlining.png")
```

##### Example: YouTube video clip in web edition, static image in PDF edition {-}
(ref:youtube-sample-video) Here's a sample YouTube caption, with option to add Markdown links and footnote.

```{r youtube-sample-video, echo=FALSE, fig.cap="(ref:youtube-sample-video)"}
if(knitr::is_html_output()) knitr::include_url("https://www.youtube.com/embed/NuWg9Jrkrpw?start=64") else knitr::include_graphics("images/2013-cthistory-video-screenshot.png")
```

##### Example: Vimeo video clip in web edition, static image in PDF edition {-}
(ref:vimeo-sample-video) Here's a sample Vimeo caption, with option to add Markdown links and footnote.

```{r vimeo-sample-vimeo, echo=FALSE, fig.cap="(ref:vimeo-sample-video)"}
if(knitr::is_html_output()) knitr::include_url("https://player.vimeo.com/video/27299734") else knitr::include_graphics("images/2011-walsh-debra.jpg")
```

##### Example: CTDA video clip in web edition, static image in PDF edition {-}
(ref:ctda-sample-video) Here's a sample CTDA video caption, with option to add Markdown link and footnote.

```{r ctda-sample-video, echo=FALSE, fig.cap="(ref:ctda-sample-video)"}
if(knitr::is_html_output()) knitr::include_url("https://collections.ctdigitalarchive.org/islandora/object/120002%3A221/datastream/MP4/view") else knitr::include_graphics("images/2014-lumpkin-mae-willie-screenshot.png")
```

##### Example: Kaltura video clip in web edition, static image in PDF edition {-}
(ref:kaltura-sample-video) Here's a sample Kaltura video caption, with option to add Markdown link and footnote.

```{r kaltura-sample-video, echo=FALSE, fig.cap="(ref:kaltura-sample-video)"}
if(knitr::is_html_output()) knitr::include_url("https://cdnapisec.kaltura.com/html5/html5lib/v2.76/mwEmbedFrame.php/p/2366381/uiconf_id/42684261/entry_id/1_1jk9ch6s?wid=_2366381&iframeembed=true&playerId=kaltura_player&entry_id=1_1jk9ch6s") else knitr::include_graphics("images/2006-hartford-profiles-1.png")
```

##### Example: Scrollable PDF in web edition, static screenshot in PDF edition {-}
(ref:pdf-sample-local) Here's a sample local scrollable PDF caption, with option to add Markdown link and footnote.

```{r pdf-sample-local, echo=FALSE, fig.cap="(ref:pdf-sample-local)"}
if(knitr::is_html_output()) knitr::include_url("images/sample-3pp.pdf") else knitr::include_graphics("images/sample-pdf-screenshot.png")
```

#### Tables {-}
For now, use Markdown table formatting, with header above and caption (in italicized text) below. See <http://www.tablesgenerator.com/> with Markdown output. TODO: Decide on Bookdown-recommended kable package for tables, link to CSV in GitHub repo, and so on.

##### Sample table {-}
| **Header 1**              | **Header 2**               | **Header 3**             |
|---------------------------|----------------------------|--------------------------|
| Security Grade            | Second                     | Third                    |
| Location                  | Hartford                   | Hartford                 |
| Trend Next Decade         | Stable                     | Stable                   |
*In the table above, insert a caption in italics, with optional links and footnote.*[@ilyankouMapFederalHOLC2017]


#### References for above {-}
- R Markdown book section on figures
  - https://bookdown.org/yihui/rmarkdown/html-document.html#figure-options
  - https://bookdown.org/yihui/rmarkdown/r-code.html#figures, which states:
  - "PDF documents are generated through the LaTeX files generated from R Markdown. A highly surprising fact to LaTeX beginners is that figures float by default: even if you generate a plot in a code chunk on the first page, the whole figure environment may float to the next page. This is just how LaTeX works by default. It has a tendency to float figures to the top or bottom of pages. Although it can be annoying and distracting, we recommend that you refrain from playing the “Whac-A-Mole” game in the beginning of your writing, i.e., desparately trying to position figures “correctly” while they seem to be always dodging you. You may wish to fine-tune the positions once the content is complete using the fig.pos chunk option (e.g., fig.pos = 'h'). See https://www.sharelatex.com/learn/Positioning_images_and_tables for possible values of fig.pos and more general tips about this behavior in LaTeX. In short, this can be a difficult problem for PDF output."
- R Markdown reference https://www.rstudio.com/wp-content/uploads/2015/03/rmarkdown-reference.pdf
- On R code chunks in RMarkdown https://bookdown.org/yihui/rmarkdown/r-code.html
- On R code chunk options in knitr package https://yihui.name/knitr/options/#code-chunk
- On positioning images in LaTeX https://www.overleaf.com/learn/latex/Positioning_images_and_tables
- Tips and tricks http://zevross.com/blog/2017/06/19/tips-and-tricks-for-working-with-images-and-figures-in-r-markdown-documents/#arguments-out.width-and-out.height-apply-to-both-existing-images-and-r-generated-figures

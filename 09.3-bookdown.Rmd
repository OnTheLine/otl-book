## Building with Bookdown, GitHub, and Zotero {-}
*by [Jack Dougherty and Ilya Ilyankou](index.html#authors-and-contributors)*

We are building this open-access book with open-source tools -- namely Bookdown, GitHub, and Zotero -- and openly sharing the knowledge we gain so that other authors and developers may improve on the process.

- [Bookdown](http://bookdown.org) allows authors to compose in a version of Markdown (an easy-to-read-and-write computer syntax that works on multiple platforms) and rely on one workflow to produce multiple editions in different formats (Web edition, PDF edition, ePUB ebook edition, and Microsoft Word documents). Bookdown requires installing the R Project statistical programming language (yes, this surprised us, too), so it may not be the best choice for novice computer users, but we have outlined basic steps below. For a detailed guide to publishing with Bookdown, see Yihui Xie, *Bookdown: Authoring Books and Technical Documents with R Markdown*, 2018, <https://bookdown.org/yihui/bookdown/>.
- [GitHub](http://github.com) is an open-source repository service that enables us to publicly share the text and code used in this book, and its [GitHub Pages](http://pages.github.com) feature allows us to freely host all of the book editions (Web, PDF, etc.) on the web. In the spirit of open-access, we intentionally make the contents of this book public while we work on it, which is consistent with the spirit of our open-access book publisher. But GitHub also allows users the option to make repositories private.
- [Zotero](http://zotero.org) is an open-source bibliography manager to collect sources and organize citations, created by the Roy Rosenzweig Center for History and New Media at George Mason University. While Bookdown does not require Zotero, scholars who work with multiple source materials will benefit from the Bookdown + Zotero + Better BibTeX workflow described below.

#### Alternatives to consider {-}
Before leaping into any software tools, consider the costs and benefits toward your goal, such as publishing a book.

- Most authors work primarily with text, and are content with a traditional book-publishing workflow, such as typing the text into a word processor and handing it to a publisher for review, copyediting, layout, and distribution. But for this book, our goal is to integrate text and digital media (interactive maps, video clips, historical documents, and links) into a publication designed both for the open web (for free) and inexpensive print (for sale).
- Some authors realize the benefits of writing collaboratively and/or sharing drafts in public or semi-public venues. One way to attain these benefits with little investment of technology and time is to compose the entire book in [Google Documents](http://docs.google.com) or a similar cloud-based word-processor, and insert static images and links to interactive maps and videos. In fact, specific chapters of this book were collaboratively composed and edited in Google Docs, then migrated to Markdown format using a Google add-on tool, [Docs to Markdown](https://chrome.google.com/webstore/detail/docs-to-markdown/igffnbdfnodiaphfmfaiiaegmoljbghf?utm_source=permalink) by ed.bacher .

An alternative book publishing platform to consider is Pressbooks. This open-source modification of WordPress multisite also supports multiple publication formats (HMTL web edition, PDF edition, ePUB ebook edition. Authors can use the <http://Pressbooks.com> paid hosting service. Or, users with advanced WordPress and some system admin skills can download the code from <http://github.com/pressbooks> and run their own self-hosted book publishing site.

#### Setup RStudio, Bookdown, and a Latex Engine {-}
Below are steps we followed to setup the publishing platform for this book, using our Macintosh OS 10.14 computers. The same general principles also should apply to Windows computers. No special knowledge is required, but these steps will be easier if users are adventurous or already familiar with R Studio, GitHub, or editing code.

- Install R Project statistical programming language <https://www.r-project.org> to build your book with Bookdown. (Yes, we too were surprised to use a statistics package to publish a book, but it works!). [See screenshot](images/bookdown/1-r-download.png)
- Install the free RStudio Desktop to make R easier to use with a visual editor. [See screenshot](images/bookdown/2-download-rstudio.png)
- Inside RStudio, select the Packages tab, and select Install. [See screenshot](images/bookdown/3-packages-install.png)
- Inside RStudio, install the "bookdown" package to build your book, and select Install Dependencies. [See screenshot](images/bookdown/4-install-bookdown.png)
- Bookdown now should be successfully installed in RStudio. [See screenshot](images/bookdown/5-installed.png)
- Inside RStudio, install the "tinytex" package for Bookdown to create a PDF edition of your book (and see more about PDF edition below) [See screenshot](images/bookdown/6-install-tinytex.png)
- Don't forget: in RStudio console, type `tinytex::install_tinytex()` and press return to finish the installation. [See screenshot](images/bookdown/7-finish-install-tinytex.png)

#### Sidenote: If tinytex installation error {-}
- In the section above, we received this error message on our Mac computers: `/usr/local/bin not writeable`. We resolved by reading the software developer's GitHub issue <https://github.com/yihui/tinytex/issues/24> and following these steps:
- In the Mac Applications > Utilities folder, open the Terminal application.
- Carefully type `sudo chown -R `whoami`:admin /usr/local/bin` and press return.
- Carefully type (without "sudo") `~/Library/TinyTeX/bin/x86_64-darwin/tlmgr path add` and press return.
- Close the Terminal application.
- In the RStudio console, type `tinytex::install_tinytex(force = TRUE)` and press return.

#### Sidenote: Tinytex vs Xelatex {-}
- this book currently uses xelatex intstead of tinytex, to avoid some error messages. Modify this in your index.Rmd settings:
  - latex_engine: xelatex


#### Download and Build a Sample Book {-}
- Create a free GitHub account <https://github.com> to share code repositories and publish book editions online.
- In your web browser, log into your GitHub account, go to the software developer's bookdown-minimal repo <https://github.com/yihui/bookdown-minimal>, and fork a copy to your GitHub account. To learn about forking in GitHub, see this chapter <http://datavizforall.org/github.html> in the *Data Visualization for All* book.
- Install GitHub Desktop <https://desktop.github.com> to transfer files between your online GitHub repo and local computer
- In your web browser, go to your forked copy of `bookdown-minimal` and click the green `Clone or Download` button and select `Open in Desktop`. This should automatically open the GitHub Desktop application, and you can navigate to copy the code repo to a folder on your local computer.
- In RStudio in the upper-right corner, select Project > Open Project to open the `bookdown-minimal` folder on your local computer. [See screenshot](images/bookdown/8-project-open.png)
- In RStudio, open the `index.Rmd` file and make some simple edits to the text of this minimal book. For example, remove the hashtag `#` comment symbol in line 8 to "uncomment" and activate the PDF book option. Save your edits. [See screenshot](images/bookdown/9-edit-book.png)
- Optional: Use your preferred text editor, such as Atom editor <https://atom.io>, to modify the text.
- In RStudio, upper-right corner, select the Build tab, select Build Book, and choose All Formats to build both the gitbook-style static web edition and PDF edition.
- If RStudio successfully builds both editions of your minimal book, the output will be saved into your `bookdown-minimal` folder, in a subfolder named `_book`, because that's how this sample is configured. The RStudio internal browser should automatically open your web edition (and it's not a very good browser, so feel free to close it). Also, open the subfolder and inspect the PDF edition. If RStudio found any errors, they will appear in the Build viewer. [See screenshot](images/bookdown/11-successful-build.png)
- Hint: In future sessions with RStudio, you may need to select Packages tab and click Update to keep bookdown and other software packages up to date. [See screenshot](images/bookdown/12-packages-update.png)
- Close RStudio.

#### Publish your Book with GitHub Pages {-}
- Open GitHub Desktop and navigate to the `bookdown-minimal` folder on your local computer. Write a summary to commit (save) the changes you made above to your master branch, and push this version to your online GitHub repo.
- In your web browser, go to your online GitHub repo, with a web address similar to `https://github.com/USERNAME/bookdown-minimal` (insert your GitHub username).
- In your GitHub repo, select Settings, scroll down to the GitHub Pages section (which is a free web hosting service to publish your code and book editions on the public web). Select Master Branch as your source, and Save.
- Scroll down to this section again, and the web address of your published site should appear. Copy this address.
- In a new browser tab, paste the web address from above, and at the end add `_book/index.html` because this sample is configured to store the web edition of your book in this subfolder. Your web address should be similar to: `https://USERNAME.github.io/bookdown-minimal/_book/index.html`

#### Customize your Bookdown and GitHub settings {-}
- To see customized settings for this book, go to its online repository <https://github.com/ontheline/ontheline-bookdown>
- In the `_bookdown.yml` file, the output directory is set to build all book formats into the `docs` folder.
- The GitHub Pages settings for this repo (which you cannot view) is set to publish from the `master/docs` folder, to match the output directory above. This simplifies the published web address to this format: `https://USERNAME.github.com/REPONAME`
- Most of the Bookdown configuration settings appear in the `index.Rmd` file. Read more about these options in the software developer's technical guide, <https://bookdown.org/yihui/bookdown/>.
- In addition, this GitHub Pages repo is published with a custom domain name <https://OnTheLine.trincoll.edu>. Learn more about custom domain names at <https://help.github.com/articles/using-a-custom-domain-with-github-pages/>, which usually requires purchasing a domain name from a web hosting service (such as <http://ReclaimHosting.com>). Adding a GitHub Pages custom domain name creates an additional `CNAME` file in the `docs` subfolder. Be careful not to delete it (or place a copy in a subfolder for safekeeping).
- This book also includes a custom `404.html` file that was manually transferred into the `docs` subfolder, since it is not automatically built by Bookdown.
- This book also includes a custom `google-analytics-otl.html` file in the root-level of repo (where bookdown looks for it) and also is manually transferred to the `docs` subfolder (since bookdown does *not appear* to copy it to there on each build). This tracks web traffic with Google Analytics.

#### About PDF edition
The Bookdown-generated PDF edition is still a work-in-progress. Read more about various options at <https://bookdown.org/yihui/rmarkdown/pdf-document.html>. Currently using xelatex engine (see bookdown.yml settings) to avoid unicode errors, but images are not ideal.
